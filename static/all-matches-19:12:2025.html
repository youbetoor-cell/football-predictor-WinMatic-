<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WinMatic – All Matches Today</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      color-scheme: dark;
      --bg: #020617;
      --border-subtle: #111827;
      --accent-purple: #8b5cf6;
      --accent-green: #22c55e;
      --accent-blue: #38bdf8;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --text-softer: #6b7280;
      --radius-lg: 24px;
      --radius-md: 18px;
      --shadow-soft: 0 24px 70px rgba(0, 0, 0, 0.85);
      --shadow-card: 0 18px 50px rgba(15, 23, 42, 0.98);
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, #2a145a 0, #05051b 40%, #020617 100%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      transition: background 0.5s ease;
    }

    /* TOP BAR (same as predictor.html) */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 30;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 22px;
      background: rgba(2, 6, 23, 0.96);
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(18px);
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand {
      display:flex;
      align-items:center;
      gap:8px;
      text-decoration: none;
      color: inherit;
    }

    .brand-logo {
      width:36px;
      height:36px;
      border-radius:9999px;
      background: radial-gradient(circle at 20% 10%, #a855f7, #6366f1 40%, #22c55e 95%);
      box-shadow:0 0 0 1px rgba(15,23,42,.9), 0 0 40px rgba(129,140,248,.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      font-size:1.1rem;
      color:#f9fafb;
    }

    .brand-name {
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:.9rem;
    }

    .brand-tagline {
      font-size:.75rem;
      color:var(--text-soft);
    }

    .nav {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:0;
    }

    .nav-item {
      border-radius:9999px;
      padding:6px 11px;
      font-size:.82rem;
      color:var(--text-soft);
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      border:1px solid transparent;
      transition:.18s;
      position: relative;
      text-decoration: none;
    }

    .nav-item::before {
      content:"●";
      font-size:.5rem;
      opacity:.7;
    }

    .nav-item:hover {
      background:#061126;
      color:var(--text);
      border-color:#111827;
      transform: translateY(-1px);
    }

    .nav-item.active {
      background:rgba(139,92,246,.18);
      border-color:rgba(139,92,246,.8);
      color:#ddd6fe;
      box-shadow:0 0 18px rgba(139,92,246,.8);
    }

    @media (max-width: 860px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .nav {
        width: 100%;
      }
    }

    /* MAIN */
    .main {
      flex:1;
      padding:18px 22px 26px;
      position:relative;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
    }

    /* HERO */
    .hero {
      position:relative;
      margin-bottom:18px;
      border-radius:var(--radius-lg);
      padding:18px 18px 16px;
      border:1px solid rgba(15,23,42,.9);
      background:
        radial-gradient(circle at top left, rgba(139,92,246,.38), transparent 62%),
        radial-gradient(circle at center right, rgba(34,197,94,.25), transparent 60%),
        #020617;
      box-shadow:var(--shadow-soft);
      overflow:hidden;
    }

    .hero-content {
      position:relative;
      display:flex;
      justify-content:space-between;
      gap:14px;
      align-items:center;
    }

    .hero-left { max-width:520px; }

    .eyebrow {
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:3px 10px;
      border-radius:9999px;
      background:rgba(15,23,42,.9);
      border:1px solid rgba(148,163,184,.3);
      font-size:.72rem;
      color:var(--text-soft);
      margin-bottom:8px;
    }

    .eyebrow-dot {
      width:7px;
      height:7px;
      border-radius:9999px;
      background:#22c55e;
      box-shadow:0 0 12px rgba(34,197,94,1);
    }

    .hero-title {
      font-size:1.7rem;
      font-weight:800;
      letter-spacing:.02em;
      margin:0 0 6px;
    }

    .hero-highlight { color:#c4b5fd; }

    .hero-subtitle {
      font-size:.9rem;
      color:var(--text-soft);
      max-width:460px;
      line-height:1.45;
    }

    .hero-right {
      min-width:220px;
      max-width:260px;
      border-radius:var(--radius-md);
      border:1px solid rgba(148,163,184,.5);
      padding:10px 13px;
      background: radial-gradient(circle at top left, rgba(15,23,42,.9), #020617);
      box-shadow:0 12px 30px rgba(15,23,42,1);
      font-size:.78rem;
    }

    .hero-right-row {
      display:flex;
      justify-content:space-between;
      margin-top:4px;
    }

    .hero-right-label { color:var(--text-softer); }
    .hero-right-value { font-weight:600; color:#bbf7d0; }

    /* CONTROL STRIP */
    .controls {
      margin:14px 0 12px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      font-size:.85rem;
    }

    .control-group {
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .control-label {
      font-size:.8rem;
      color:var(--text-soft);
    }

    .date-input {
      border-radius:9999px;
      border:1px solid #111827;
      background:#020617;
      color:var(--text);
      padding:4px 10px;
      font-size:.85rem;
    }

    .btn {
      border-radius:9999px;
      padding:6px 14px;
      border:none;
      cursor:pointer;
      font-size:.82rem;
      display:inline-flex;
      align-items:center;
      gap:6px;
      transition:.18s;
    }

    .btn-primary {
      background:linear-gradient(135deg, #6366f1, #22c55e);
      color:#f9fafb;
      box-shadow:0 0 18px rgba(129,140,248,.9);
    }

    .btn-primary:hover {
      transform:translateY(-1px);
      box-shadow:0 0 26px rgba(94,234,212,.9);
    }

    .leagues-pill {
      font-size:.78rem;
      color:var(--text-softer);
      border-radius:9999px;
      border:1px solid rgba(148,163,184,.4);
      padding:4px 10px;
      background:rgba(15,23,42,.8);
    }

    .status-line {
      font-size:.78rem;
      color:var(--text-softer);
      margin-top:4px;
    }

    /* MATCHES PANEL / CARDS (re-use predictor style) */
    .panel-matches {
      border-radius:var(--radius-md);
      background:radial-gradient(circle at top left, rgba(15,23,42,.96), #020617);
      border:1px solid rgba(15,23,42,1);
      padding:11px 13px;
      box-shadow:var(--shadow-card);
      margin-bottom:12px;
    }

    .panel-header {
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      margin-bottom:6px;
    }

    .panel-title { font-size:.96rem; font-weight:600; }
    .panel-subtitle { font-size:.78rem; color:var(--text-softer); }

    .matches-list {
      margin-top:6px;
      max-height:560px;
      overflow-y:auto;
      padding-right:4px;
    }

    @keyframes fadeSlideUp {
      0%{opacity:0; transform:translateY(14px);}
      100%{opacity:1; transform:translateY(0);}
    }

    .match-card {
      position: relative;
      overflow: visible;
      border-radius: 18px;
      background: radial-gradient(circle at top, #020617, #020617 50%, #020617 100%);
      border: 1px solid #111827;
      padding: 10px 12px;
      margin-bottom: 10px;
      font-size: 0.84rem;
      transition: border-color .18s, box-shadow .18s, transform .18s, background .22s;
      animation: fadeSlideUp .5s ease-out both;
      animation-delay: calc(var(--card-index, 0) * 45ms);
    }

    .match-card:hover {
      border-color: rgba(129,140,248,.85);
      box-shadow:0 18px 50px rgba(15,23,42,1);
      transform:translateY(-2px);
    }

        /* AI edge ribbons (same style as predictor/value cards) */
    .match-card.value-bet,
    .match-card.value-bet-strong {
      position: relative;
      overflow: visible;
    }

    .match-card.value-bet::before,
    .match-card.value-bet-strong::before {
      content: "";
      position: absolute;
      top: 0.6rem;
      left: 0.9rem;
      z-index: 10;
      padding: 0.25rem 0.65rem;
      border-radius: 9999px;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }

    .match-card.value-bet::before {
      content: "AI edge";
      background: linear-gradient(135deg,#22c55e,#16a34a);
      border: 1px solid #16a34a;
      color: #eafff2;
    }

    .match-card.value-bet-strong::before {
      content: "Strong AI edge";
      background: linear-gradient(135deg,#facc15,#eab308);
      border: 1px solid #fbbf24;
      color: #111;
      text-shadow: 0 0 3px rgba(255,255,255,0.4);
    }


    .match-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .league-pill {
      font-size:.72rem;
      padding:3px 9px;
      border-radius:9999px;
      border:1px solid rgba(148,163,184,.45);
      background:rgba(15,23,42,.95);
      color:var(--text-soft);
    }

    .kickoff {
      font-size:.76rem;
      color:var(--text-softer);
    }

    .match-row {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-top:6px;
    }

    .team-name {
      font-weight:600;
      font-size:.9rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .match-center {
      text-align:center;
      min-width:0;
    }

        /* --- Predictor-style teams with logo orbs --- */
    .match-team {
      display:flex;
      align-items:center;
      gap:8px;
      min-width:0;
    }

    .match-team-home {
      text-align:left;
    }

    .match-team-away {
      margin-left:auto;
      text-align:right;
      justify-content:flex-end;
    }

    .team-logo-orb-sm {
      width:30px;
      height:30px;
      border-radius:9999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a 60%, #064e3b 100%);
      position:relative;
      box-shadow:0 0 18px rgba(34,197,94,.9);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .team-logo-orb-sm.away {
      background: radial-gradient(circle at 30% 20%, #6366f1, #4f46e5 60%, #1e3a8a 100%);
      box-shadow:0 0 18px rgba(129,140,248,.9);
    }

    .team-logo-orb-sm::after {
      content:"";
      position:absolute;
      inset:2px;
      border-radius:inherit;
      border:1px solid rgba(248,250,252,.4);
      box-shadow: inset 0 0 10px rgba(15,23,42,.9);
      pointer-events:none;
    }

    .team-logo-initial-sm {
      position:relative;
      z-index:1;
      font-size:.8rem;
      font-weight:700;
      color:#f9fafb;
    }

    /* --- Expandable details area --- */
    .match-body {
      margin-top:6px;
      max-height:0;
      overflow:hidden;
      opacity:0;
      transition:max-height .25s ease, opacity .25s ease, margin-top .25s ease;
    }

    .match-card.expanded .match-body {
      max-height:320px;
      opacity:1;
      margin-top:12px;
    }

    .match-body-row {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      font-size:.78rem;
      color:var(--text-soft);
    }

    .match-body-col {
      flex:1 1 160px;
      min-width:0;
    }

    .match-body-label {
      font-size:.75rem;
      color:var(--text-softer);
      margin-bottom:2px;
    }

    .match-body-value {
      font-size:.9rem;
      font-weight:600;
    }

    .scoreline {
      font-size:1rem;
      font-weight:600;
    }

    .probs {
      font-size:.76rem;
      color:var(--text-softer);
      margin-top:2px;
    }

    .fav-pill {
      font-size:.72rem;
      margin-top:4px;
      display:inline-flex;
      align-items:center;
      gap:5px;
      padding:3px 8px;
      border-radius:9999px;
      border:1px solid rgba(34,197,94,.7);
      background:rgba(22,163,74,.16);
      color:#bbf7d0;
    }
    
        /* Predictor-style teams + logos + expandable body */
    .match-team {
      display:flex;
      align-items:center;
      gap:8px;
      min-width:0;
    }

    .match-team-home {
      text-align:left;
    }

    .match-team-away {
      margin-left:auto;
      text-align:right;
      justify-content:flex-end;
    }

    .team-logo-orb-sm {
      width:30px;
      height:30px;
      border-radius:9999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a 60%, #064e3b 100%);
      position:relative;
      box-shadow:0 0 18px rgba(34,197,94,.9);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .team-logo-orb-sm.away {
      background: radial-gradient(circle at 30% 20%, #6366f1, #4f46e5 60%, #1e3a8a 100%);
      box-shadow:0 0 18px rgba(129,140,248,.9);
    }

    .team-logo-orb-sm::after {
      content:"";
      position:absolute;
      inset:2px;
      border-radius:inherit;
      border:1px solid rgba(248,250,252,.4);
      box-shadow: inset 0 0 10px rgba(15,23,42,.9);
      pointer-events:none;
    }

    .team-logo-orb-sm img {
      width:80%;
      height:80%;
      object-fit:contain;
      position:relative;
      z-index:1;
      border-radius:9999px;
      background:#020617;
    }

    .team-logo-initial-sm {
      position:relative;
      z-index:1;
      font-size:.8rem;
      font-weight:700;
      color:#f9fafb;
    }

    .match-body {
      margin-top:6px;
      max-height:0;
      overflow:hidden;
      opacity:0;
      transition:max-height .25s ease, opacity .25s ease, margin-top .25s ease;
    }

    .match-card.expanded .match-body {
      max-height:320px;
      opacity:1;
      margin-top:12px;
    }

    .match-body-row {
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      font-size:.78rem;
      color:var(--text-soft);
    }

    .match-body-col {
      flex:1 1 160px;
      min-width:0;
    }

    .match-body-label {
      font-size:.75rem;
      color:var(--text-softer);
      margin-bottom:2px;
    }

    .match-body-value {
      font-size:.9rem;
      font-weight:600;
    }

    .empty { font-size:.8rem; color:var(--text-softer); margin-top:4px; }
  </style>
</head>
<body>
  <!-- Desktop: tiny hover strip that reveals the header -->
  <div class="topbar-hover-zone"></div>

  <header class="topbar">
    <div class="topbar-left">
      <a href="index.html" class="brand">
        <div class="brand-logo">W</div>
        <div>
          <div class="brand-name">WINMATIC</div>
          <div class="brand-tagline">AI Match Edge Engine</div>
        </div>
      </a>
    </div>
    <div class="topbar-right">
      <nav class="nav">
          <a href="index.html" class="nav-item">Home</a>
        <a href="predictor.html" class="nav-item">Predictions</a>
        <a href="all-matches.html" class="nav-item active">All matches (today)</a>
        <a href="value.html" class="nav-item">Value Scanner</a>
        <a href="bets.html" class="nav-item">Bet of the day</a>
        <a href="progress.html" class="nav-item">Progress</a>
        <a href="results.html" class="nav-item">Results</a>
        <a href="metrics.html#metrics" class="nav-item">Metrics</a>
        <a href="tutorial.html" class="nav-item">Tutorial</a>
        <a href="pricing.html" class="nav-item">View pricing</a>
        <a href="contact.html" class="nav-item">Contact</a>
      </nav>
    </div>

  </header>

  <main class="main">
    <!-- HERO -->
    <section class="hero">
      <div class="hero-content">
        <div class="hero-left">
          <div class="eyebrow">
            <span class="eyebrow-dot"></span>
            <span>Live model view</span>
          </div>
          <h1 class="hero-title">
            All <span class="hero-highlight">modelled matches</span> for the day
          </h1>
          <p class="hero-subtitle">
            One glance across all big 5 leagues + Portugal. See the predicted scoreline
            and 1X2 probabilities for every game your WinMatic engine has a view on.
          </p>
        </div>
        <aside class="hero-right">
          <div class="hero-right-row">
            <span class="hero-right-label">Leagues</span>
            <span class="hero-right-value">ENG · ESP · ITA · GER · FRA · POR</span>
          </div>
          <div class="hero-right-row">
            <span class="hero-right-label">Source</span>
            <span class="hero-right-value">Same model as Predictor</span>
          </div>
          <div class="hero-right-row">
            <span class="hero-right-label">View</span>
            <span class="hero-right-value">Per-match 1X2 & scoreline</span>
          </div>
        </aside>
      </div>
    </section>

    <!-- Controls -->
    <section class="controls">
      <div class="control-group">
        <span class="control-label">Date</span>
        <input id="matches-date" class="date-input" type="date" />
        <button id="btn-today" class="btn btn-primary">Today</button>
      </div>
      <div class="control-group">
        <span class="leagues-pill">
          Big 5 + Portugal: Premier League, La Liga, Serie A, Bundesliga, Ligue 1, Primeira Liga
        </span>
      </div>
    </section>

    <div class="status-line" id="status-text">Loading…</div>

    <!-- Matches list -->
    <section class="panel-matches">
      <div class="panel-header">
        <div>
          <div class="panel-title">All matches with model predictions</div>
          <div class="panel-subtitle">
            Sorted by kickoff time across all tracked leagues.
          </div>
        </div>
      </div>
      <div id="matches-list" class="matches-list">
        <!-- Cards injected here -->
      </div>
    </section>
  </main>

  <script>
    // ---------------------------
    // WinMatic helper: fetch w/ timeout + retry (Render cold starts can cause 502/504)
    // ---------------------------
    function sleep(ms) { return new Promise((r) => setTimeout(r, ms)); }

    async function fetchWithRetry(url, options = {}, retries = 2, timeoutMs = 25000) {
      for (let attempt = 0; attempt <= retries; attempt++) {
        try {
          const controller = new AbortController();
          const t = setTimeout(() => controller.abort(), timeoutMs);
          const res = await fetchWithRetry(url, { ...options, signal: controller.signal });
          clearTimeout(t);

          // retry on transient gateway / overload / quota hiccups
          if ([429, 502, 503, 504].includes(res.status) && attempt < retries) {
            await sleep(600 * (attempt + 1));
            continue;
          }

          return res;
        } catch (err) {
          if (attempt < retries) {
            await sleep(600 * (attempt + 1));
            continue;
          }
          throw err;
        }
      }
    }

    async function readErrorBody(res) {
      try {
        const txt = await res.text();
        return (txt || "").slice(0, 200);
      } catch {
        return "";
      }
    }

    // ---- CONFIG: leagues to show ----
    const LEAGUES = [
      { id: 39,  name: "Premier League",        short: "ENG" },
      { id: 140, name: "La Liga",               short: "ESP" },
      { id: 135, name: "Serie A",               short: "ITA" },
      { id: 78,  name: "Bundesliga",            short: "GER" },
      { id: 61,  name: "Ligue 1",               short: "FRA" },
      // Adjust this ID if your API-Football Primeira Liga ID is different:
      { id: 94,  name: "Primeira Liga",         short: "POR" }
    ];

    function isoDate(d) {
      const year = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${year}-${m}-${day}`;
    }

    function formatKickoff(kickoffUtc) {
      if (!kickoffUtc) return { date: "", time: "" };
      const d = new Date(kickoffUtc);
      const date = d.toLocaleDateString(undefined, { day: "2-digit", month: "short" });
      const time = d.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit" });
      return { date, time };
    }

    function toPercent(p) {
      if (typeof p !== "number" || !isFinite(p)) return 0;
      return Math.round(p * 100);
    }

    function getTeamInitials(name) {
      if (!name) return "?";
      const parts = name.split(" ").filter(Boolean);
      if (parts.length === 1) {
        return parts[0].slice(0, 3).toUpperCase();
      }
      // e.g. "Manchester United" -> "MU"
      return (parts[0][0] + parts[1][0]).toUpperCase();
    }

    function createMatchCard(fx, leagueMeta, index) {
      const p = fx.predictions || fx;

      const home =
        fx.home_name ||
        fx.home_team ||
        fx.home ||
        (fx.teams && fx.teams.home && fx.teams.home.name) ||
        "Home";
      const away =
        fx.away_name ||
        fx.away_team ||
        fx.away ||
        (fx.teams && fx.teams.away && fx.teams.away.name) ||
        "Away";

      const homeLogo = fx.home_logo || (fx.home_id ? `/team-logo/${fx.home_id}.png` : "");
      const awayLogo = fx.away_logo || (fx.away_id ? `/team-logo/${fx.away_id}.png` : "");
      const homeInitial = (home && home.charAt(0)) || "H";
      const awayInitial = (away && away.charAt(0)) || "A";

      const homeGoalsVal =
        typeof p.home_goals === "number"
          ? p.home_goals
          : typeof fx.pred_home_goals === "number"
          ? fx.pred_home_goals
          : 0;
      const awayGoalsVal =
        typeof p.away_goals === "number"
          ? p.away_goals
          : typeof fx.pred_away_goals === "number"
          ? fx.pred_away_goals
          : 0;

      const homeGoals = homeGoalsVal.toFixed(1);
      const awayGoals = awayGoalsVal.toFixed(1);

      const homeP = toPercent(
        p.home_win_p ?? p.prob_home_win ?? p.model_home_p ?? (p.model_probs && p.model_probs.home)
      );
      const drawP = toPercent(
        p.draw_p ?? p.prob_draw ?? p.model_draw_p ?? (p.model_probs && p.model_probs.draw)
      );
      const awayP = toPercent(
        p.away_win_p ?? p.prob_away_win ?? p.model_away_p ?? (p.model_probs && p.model_probs.away)
      );

      let fav = "Draw";
      let favP = drawP;
      if (homeP >= awayP && homeP >= drawP) {
        fav = "Home";
        favP = homeP;
      } else if (awayP >= homeP && awayP >= drawP) {
        fav = "Away";
        favP = awayP;
      }

      const { date, time } = formatKickoff(
        fx.kickoff_utc || fx.match_date || fx.date || (fx.fixture && fx.fixture.date)
      );

      const card = document.createElement("article");
      card.className = "match-card";
      card.style.setProperty("--card-index", String(index));

      card.innerHTML = `
        <div class="match-header">
          <div class="league-pill">${leagueMeta.short} • ${leagueMeta.name}</div>
          <div class="kickoff">${date || ""} · ${time || ""}</div>
        </div>
        <div class="match-row">
          <div class="match-team match-team-home">
            <div class="team-logo-orb-sm">
              ${
                homeLogo
                  ? `<img src="${homeLogo}" alt="${home} logo" />`
                  : `<span class="team-logo-initial-sm">${homeInitial}</span>`
              }
            </div>
            <div class="team-name">${home}</div>
          </div>
          <div class="match-center">
            <div class="scoreline">${homeGoals} – ${awayGoals}</div>
            <div class="probs">H: ${homeP}% · D: ${drawP}% · A: ${awayP}%</div>
            <div class="fav-pill">
              <span>Model favourite:</span>
              <strong>${fav === "Home" ? home : fav === "Away" ? away : "Draw"} (${favP}%)</strong>
            </div>
          </div>
          <div class="match-team match-team-away">
            <div class="team-name">${away}</div>
            <div class="team-logo-orb-sm away">
              ${
                awayLogo
                  ? `<img src="${awayLogo}" alt="${away} logo" />`
                  : `<span class="team-logo-initial-sm">${awayInitial}</span>`
              }
            </div>
          </div>
        </div>
        <div class="match-body">
          <div class="match-body-row">
            <div class="match-body-col">
              <div class="match-body-label">Predicted score</div>
              <div class="match-body-value">${home} ${homeGoals} – ${awayGoals} ${away}</div>
            </div>
            <div class="match-body-col">
              <div class="match-body-label">Win / Draw / Away</div>
              <div class="match-body-value">H ${homeP}% · D ${drawP}% · A ${awayP}%</div>
            </div>
            <div class="match-body-col">
              <div class="match-body-label">League & kickoff</div>
              <div class="match-body-value">${leagueMeta.short} • ${date || ""} · ${time || ""}</div>
            </div>
          </div>
        </div>
      `;

      // Click to expand / collapse details (like predictor)
      card.addEventListener("click", () => {
        card.classList.toggle("expanded");
      });

      return card;
    }


    async function loadMatchesForDate(dateStr) {
      const container = document.getElementById("matches-list");
      const statusEl = document.getElementById("status-text");

      container.innerHTML = "";
      statusEl.textContent = "Loading matches…";

      const collected = [];

      for (const league of LEAGUES) {
        const url = `/predict/by-date?league=${league.id}&from_date=${dateStr}&to_date=${dateStr}`;
        try {
          const resp = await fetchWithRetry(url);
          if (!resp.ok) {
            console.warn("Failed for league", league.id, "status", resp.status);
            continue;
          }
          const data = await resp.json();
          const fixtures = data.matches || data.fixtures || [];
          fixtures.forEach((fx, i) => {
            const kickoffRaw =
              fx.kickoff_utc || fx.match_date || fx.date || (fx.fixture && fx.fixture.date) || (dateStr + "T00:00:00Z");
            const ts = new Date(kickoffRaw).getTime() || (Date.now() + i);
            collected.push({ ts, league, fx });
          });
        } catch (err) {
          console.error("Error loading league", league.id, err);
        }
      }

      if (!collected.length) {
        statusEl.textContent = "No modelled matches for this date.";
        container.innerHTML =
          '<div class="empty">No predicted matches found across the tracked leagues. Try another day or retrain your model.</div>';
        return;
      }

      collected.sort((a, b) => a.ts - b.ts);

      collected.forEach((item, idx) => {
        const card = createMatchCard(item.fx, item.league, idx);
        container.appendChild(card);
      });

      statusEl.textContent = `Showing ${collected.length} matches across ${LEAGUES.length} leagues.`;
    }

    function initAllMatchesPage() {
      const dateInput = document.getElementById("matches-date");
      const todayBtn = document.getElementById("btn-today");

      const today = new Date();
      const todayStr = isoDate(today);
      if (dateInput) dateInput.value = todayStr;

      if (todayBtn) {
        todayBtn.addEventListener("click", () => {
          const now = new Date();
          const s = isoDate(now);
          dateInput.value = s;
          loadMatchesForDate(s);
        });
      }

      if (dateInput) {
        dateInput.addEventListener("change", () => {
          if (!dateInput.value) return;
          loadMatchesForDate(dateInput.value);
        });
      }

      loadMatchesForDate(todayStr);
    }

    document.addEventListener("DOMContentLoaded", initAllMatchesPage);
  </script>
</body>
</html>
