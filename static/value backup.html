<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Value Bets | WINMATIC</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
  body {
    background: #0b0b0b;
    color: #f8f8f8;
    font-family: "Inter", sans-serif;
  }

  .wm-hero {
    text-align: center;
    margin-bottom: 2rem;
  }

  .wm-hero-text h1 {
    font-size: 2.5rem;
    font-weight: 700;
    background: linear-gradient(90deg, #00f0ff, #00ff85);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .wm-card {
    max-width: 1200px;
    margin: auto;
    background: #121212;
    border: 1px solid #1e1e1e;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 0 30px rgba(0, 255, 136, 0.05);
  }

  .wm-card-header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    align-items: center;
    border-bottom: 1px solid #222;
    padding-bottom: 1rem;
    margin-bottom: 1rem;
  }

  .wm-controls label {
    margin-right: 1rem;
  }

  select {
    background: #1a1a1a;
    color: #fff;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 0.4rem 0.8rem;
  }

  .wm-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
  }

  .wm-table th {
    background: #191919;
    padding: 0.8rem;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1px;
    color: #aaa;
    border-bottom: 1px solid #222;
  }

  .wm-table td {
    padding: 1rem;
    border-bottom: 1px solid #222;
    font-size: 1rem;
  }

  .wm-table tr:hover {
    background: rgba(0, 255, 136, 0.05);
    transition: 0.2s;
  }

  .outcome-home {
    color: #00ff85;
    font-weight: 600;
  }

  .outcome-away {
    color: #00c3ff;
    font-weight: 600;
  }

  .outcome-draw {
    color: #ffdf00;
    font-weight: 600;
  }

  .edge-badge {
    padding: 0.3rem 0.7rem;
    border-radius: 6px;
    background: linear-gradient(90deg, #00ff85, #00c3ff);
    color: #000;
    font-weight: 700;
    animation: pulse 1.6s infinite alternate;
  }

  @keyframes pulse {
    from { box-shadow: 0 0 4px #00ff85; }
    to { box-shadow: 0 0 15px #00c3ff; }
  }

  .wm-card-subtitle {
    color: #aaa;
    font-size: 0.9rem;
  }
</style>

</head>
<body>
  <header class="wm-header">
    <div class="wm-header-left">
      <div class="wm-logo">W</div>
      <div class="wm-brand">
        <div class="wm-brand-name">WinMatic</div>
        <div class="wm-brand-tagline">AI Football Edge</div>
      </div>
    </div>
    <nav class="wm-nav">
      <a href="index.html">Home</a>
      <a href="predictor.html">Predictions</a>
      <a href="metrics.html">Metrics</a>
      <a href="value.html" class="active">Value</a>
    </nav>
    <div class="wm-header-right">
      <button class="wm-btn-outline">Log in</button>
      <button class="wm-btn-primary">Get Access</button>
    </div>
  </header>

  <main class="wm-main">
    <section class="wm-hero">
      <div class="wm-hero-text">
        <h1>Value Scanner</h1>
        <p>
          Scan upcoming fixtures where WinMatic’s predicted probability is
          significantly higher than the market’s implied probability.
        </p>
      </div>
    </section>

    <section class="wm-card">
      <div class="wm-card-header">
        <div>
          <h2>AI Value Bets</h2>
          <p class="wm-card-subtitle" id="valueSubtitle">
            Premier League • next 7 days
          </p>
        </div>
        <div class="wm-controls">
          <label>
            League:
            <select id="leagueFilter">
              <option value="39" selected>Premier League</option>
              <option value="140">La Liga</option>
              <option value="135">Serie A</option>
              <option value="78">Bundesliga</option>
              <option value="61">Ligue 1</option>
            </select>
          </label>
          <label>
            Days ahead:
            <select id="daysFilter">
              <option value="3">3 days</option>
              <option value="7" selected>7 days</option>
              <option value="14">14 days</option>
            </select>
          </label>
          <label>
            Min edge:
            <select id="edgeFilter">
              <option value="0.03">3 pts+</option>
              <option value="0.05" selected>5 pts+</option>
              <option value="0.08">8 pts+</option>
              <option value="0.10">10 pts+</option>
            </select>
          </label>
        </div>
      </div>

      <div class="wm-table-wrapper">
        <table class="wm-table">
          <thead>
            <tr>
              <th>Fixture</th>
              <th>Kickoff (UTC)</th>
              <th>Outcome</th>
              <th>Model %</th>
              <th>Market %</th>
              <th>Edge (pts)</th>
            </tr>
          </thead>
          <tbody id="valueTableBody">
            <tr><td colspan="6">Loading value bets...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Value root (not used yet, safe to keep for future React/etc) -->
  <div id="value-root"></div>

  <script>
    const LEAGUE_NAMES = {
      "39": "Premier League",
      "140": "La Liga",
      "135": "Serie A",
      "78": "Bundesliga",
      "61": "Ligue 1"
    };

    function updateSubtitle(leagueId, daysAhead) {
      const el = document.getElementById("valueSubtitle");
      if (!el) return;
      const leagueName = LEAGUE_NAMES[leagueId] || `League ${leagueId}`;
      const daysLabel = daysAhead === "1"
        ? "next day"
        : `next ${daysAhead} days`;
      el.textContent = `${leagueName} • ${daysLabel}`;
    }

    function loadValueBets(leagueId, daysAhead, minEdge) {
      const tbody = document.getElementById("valueTableBody");
      tbody.innerHTML = "<tr><td colspan='6'>Loading value bets...</td></tr>";

      fetch(`/value-bets?league=${leagueId}&days_ahead=${daysAhead}&min_edge=${minEdge}`)
        .then(r => r.json())
        .then(data => {
          tbody.innerHTML = "";

          if (!data.ok || data.count === 0) {
            tbody.innerHTML =
              "<tr><td colspan='6'>No value bets found for this filter.</td></tr>";
            return;
          }

          data.fixtures.forEach(fx => {
            const vb = fx.value_bet;
            const ko = fx.kickoff_utc || "";
            const row = document.createElement("tr");

            const edgePts = (vb.edge * 100).toFixed(1);
            const edgeColor = vb.edge >= 0.08 ? "#4ade80" : "#eab308";

            const outcomeClass =
              vb.outcome === "home"
              ? "outcome-home"
              : vb.outcome === "away"
              ? "outcome-away"
              : "outcome-draw";

            row.innerHTML = `
             <td>
              <div style="display:flex;align-items:center;gap:6px;">
                <img src="${fx.home_logo}" alt="${fx.home_name}" width="24" height="24" />
                <span>${fx.home_name}</span>
                <span style="color:#777;">vs</span>
                <img src="${fx.away_logo}" alt="${fx.away_name}" width="24" height="24" />
                <span>${fx.away_name}</span>
              </div>
            </td>
            <td>${ko.replace("T", " ").replace("+00:00", " UTC")}</td>
            <td class="${outcomeClass}">${vb.outcome.toUpperCase()}</td>
            <td>${(vb.model_prob * 100).toFixed(1)}%</td>
            <td>${(vb.market_prob * 100).toFixed(1)}%</td>
            <td><span class="edge-badge">+${edgePts} pts</span></td>
          `;

            tbody.appendChild(row);
          });
        })
        .catch(err => {
          tbody.innerHTML =
            `<tr><td colspan='6'>Error: ${err.message}</td></tr>`;
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
      const leagueSelect = document.getElementById("leagueFilter");
      const daysSelect = document.getElementById("daysFilter");
      const edgeSelect = document.getElementById("edgeFilter");

      function refresh() {
        const leagueId = leagueSelect.value;
        const daysAhead = daysSelect.value;
        const minEdge = edgeSelect.value;
        updateSubtitle(leagueId, daysAhead);
        loadValueBets(leagueId, daysAhead, minEdge);
      }

      leagueSelect.addEventListener("change", refresh);
      daysSelect.addEventListener("change", refresh);
      edgeSelect.addEventListener("change", refresh);

      // initial load
      refresh();
    });
  </script>

  <!-- API status (if you want the status dot on this page too) -->
  <script src="/static/js/status.js"></script>

  <!-- Value scanner (external JS, optional/for future) -->
  <script src="/static/js/value.js"></script>
</body>
</html>
