<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Value Scanner | WinMatic</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    body {
      background: #0b0b0b;
      color: #f8f8f8;
      font-family: "Inter", sans-serif;
    }
    .wm-hero {
      text-align: center;
      margin-bottom: 2rem;
    }
    .wm-hero-text h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #00f0ff, #00ff85);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .wm-card {
      max-width: 1200px;
      margin: auto;
      background: #121212;
      border: 1px solid #1e1e1e;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.05);
    }
    .wm-card-header {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      align-items: center;
      border-bottom: 1px solid #222;
      padding-bottom: 1rem;
      margin-bottom: 1rem;
    }
    .wm-controls label { margin-right: 1rem; }
    select {
      background: #1a1a1a;
      color: #fff;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
    }
    .wm-btn-scan {
      background: linear-gradient(90deg, #00f0ff, #00ff85);
      color: #000;
      border: none;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      font-weight: 600;
      cursor: pointer;
    }
    .wm-btn-scan:hover {
      filter: brightness(1.1);
    }
    .quota-flag {
      display: none;
      margin-top: 0.5rem;
      padding: 0.3rem 0.7rem;
      background: rgba(255, 77, 77, 0.15);
      border: 1px solid #f66;
      border-radius: 8px;
      font-size: 0.8rem;
      color: #f77;
    }
    .wm-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .wm-table th {
      background: #191919;
      padding: 0.8rem;
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 1px;
      color: #aaa;
      border-bottom: 1px solid #222;
    }
    .wm-table td {
      padding: 1rem;
      border-bottom: 1px solid #222;
      font-size: 1rem;
    }
    .wm-table tr:hover {
      background: rgba(0, 255, 136, 0.05);
      transition: 0.2s;
    }
    .edge-badge {
      padding: 0.3rem 0.7rem;
      border-radius: 6px;
      background: linear-gradient(90deg, #00ff85, #00c3ff);
      color: #000;
      font-weight: 700;
      animation: pulse 1.6s infinite alternate;
    }
    @keyframes pulse {
      from { box-shadow: 0 0 4px #00ff85; }
      to { box-shadow: 0 0 15px #00c3ff; }
    }
    .outcome-home { color: #00ff85; font-weight: 600; }
    .outcome-away { color: #00c3ff; font-weight: 600; }
    .outcome-draw { color: #ffdf00; font-weight: 600; }
  </style>
</head>
<body>
  <header class="wm-header">
    <div class="wm-header-left">
      <div class="wm-logo">W</div>
      <div class="wm-brand">
        <div class="wm-brand-name">WinMatic</div>
        <div class="wm-brand-tagline">AI Football Edge</div>
      </div>
    </div>
    <nav class="wm-nav">
      <a href="index.html">Home</a>
      <a href="predictor.html">Predictions</a>
      <a href="metrics.html">Metrics</a>
      <a href="value.html" class="active">Value</a>
    </nav>
    <div class="wm-header-right">
      <button class="wm-btn-outline">Log in</button>
      <button class="wm-btn-primary">Get Access</button>
    </div>
  </header>

  <main class="wm-main">
    <section class="wm-hero">
      <div class="wm-hero-text">
        <h1>Value Scanner</h1>
        <p>Compare model probabilities with bookmaker odds to find edges.</p>
      </div>
    </section>

    <section class="wm-card">
      <div class="wm-card-header">
        <div>
          <h2>AI Value Bets</h2>
          <p class="wm-card-subtitle" id="valueSubtitle">Premier League ‚Ä¢ next 7 days</p>
          <div id="quotaFlag" class="quota-flag">‚ö†Ô∏è API quota exhausted ‚Äì showing cached odds</div>
        </div>
        <div class="wm-controls">
          <label>
            League:
            <select id="leagueFilter">
              <option value="39" selected>Premier League</option>
              <option value="140">La Liga</option>
              <option value="135">Serie A</option>
              <option value="78">Bundesliga</option>
              <option value="61">Ligue 1</option>
            </select>
          </label>
          <label>
            Days ahead:
            <select id="daysFilter">
              <option value="3">3</option>
              <option value="7" selected>7</option>
              <option value="14">14</option>
            </select>
          </label>
          <label>
            Min edge:
            <select id="edgeFilter">
              <option value="0.03">3%</option>
              <option value="0.05" selected>5%</option>
              <option value="0.08">8%</option>
            </select>
          </label>
          <button class="wm-btn-scan" id="scanBtn">üîé Scan</button>
        </div>
      </div>

      <table class="wm-table">
        <thead>
          <tr>
            <th>Fixture</th>
            <th>Kickoff (UTC)</th>
            <th>Outcome</th>
            <th>Model %</th>
            <th>Market %</th>
            <th>Edge</th>
          </tr>
        </thead>
        <tbody id="valueTableBody">
          <tr><td colspan="6">Loading value bets...</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <script>
    const LEAGUES = {
      "39": "Premier League", "140": "La Liga", "135": "Serie A",
      "78": "Bundesliga", "61": "Ligue 1"
    };
    const quotaFlag = document.getElementById("quotaFlag");
    const tbody = document.getElementById("valueTableBody");

    function updateSubtitle(league, days) {
      document.getElementById("valueSubtitle").textContent =
        `${LEAGUES[league] || league} ‚Ä¢ next ${days} days`;
    }

    async function loadValueBets() {
      const league = document.getElementById("leagueFilter").value;
      const days = document.getElementById("daysFilter").value;
      const edge = document.getElementById("edgeFilter").value;
      updateSubtitle(league, days);
      tbody.innerHTML = "<tr><td colspan='6'>Loading...</td></tr>";
      quotaFlag.style.display = "none";

      try {
        const res = await fetch(`/value/upcoming?league=${league}&days_ahead=${days}&min_edge=${edge}`);
        const data = await res.json();
        tbody.innerHTML = "";
        if (!res.ok) throw new Error(data.detail || res.statusText);

        if (data.quota_exhausted) quotaFlag.style.display = "block";
        if (!data.fixtures?.length) {
          tbody.innerHTML = "<tr><td colspan='6'>No value bets found.</td></tr>";
          return;
        }

        for (const fx of data.fixtures) {
          const vb = fx.value_bet || {};
          const edgePts = (vb.edge * 100).toFixed(1);
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${fx.home_name} vs ${fx.away_name}</td>
            <td>${(fx.kickoff_utc || "").replace("T", " ").replace("+00:00", " UTC")}</td>
            <td class="outcome-${vb.outcome}">${vb.outcome?.toUpperCase() || "-"}</td>
            <td>${(vb.model_prob * 100).toFixed(1)}%</td>
            <td>${(vb.market_prob * 100).toFixed(1)}%</td>
            <td><span class="edge-badge">+${edgePts}%</span></td>
          `;
          tbody.appendChild(row);
        }
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan='6'>Error: ${err.message}</td></tr>`;
      }
    }

    document.getElementById("scanBtn").addEventListener("click", loadValueBets);
    document.querySelectorAll("#leagueFilter, #daysFilter, #edgeFilter")
      .forEach(el => el.addEventListener("change", loadValueBets));

    loadValueBets();
  </script>
</body>
</html>
